<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    {% if request.user.is_authenticated  %}
    <title>{{request.user}}</title>
    {% endif %}
    <link rel="stylesheet" href="static/css/styles.css">
  </head>
  <body>
    <table>
      <tr>
        <th style="width: 33%; text-align: left;">
          <div>Dobrodo≈°li, {{request.user}}!</div>
        </th>
        <th style="width: 33%; text-align: center;">
          <div>Razgovor</div>
        </th>
        <th style="width: 33%; text-align: right; ">
          {% if request.user.is_authenticated  %}
            <button id="odjavaBtn">
              <a style="text-decoration:none; color: #DFD8D8;" href = "{% url 'logout' %}">Odjava</a>
            </button>
          {% endif %}
        </th>
      </tr>
    </table>
    <hr style="border-top: groove;">
    <textarea readonly disabled="true" id="kontejner_Poruka" ></textarea>
      <div style="bottom: 5px; position: fixed;">
      <table>
        <tr>
          <th style="width: 10%;">
            <label style="vertical-align: baseline;">Message: </label>
          </th>
          <th style="width: 80%;">
            <input type="text" id="unos_Poruka"></input>
          </th>
          <th style="width: 10%;">
            <button type="submit" id="potvrdi_Unos">&#10095;</button>
          </th>
        </tr>
      </table>
    </div>
    <script>
      const sock = new WebSocket("ws://" + window.location.host + "/");

      document.querySelector("#unos_Poruka").onkeyup = function(event) {
          if (event.keyCode == 13) {
              document.querySelector("#potvrdi_Unos").click();
          }
      };

      document.querySelector("#potvrdi_Unos").onclick = function(event) {
          var messageInput = document.querySelector("#unos_Poruka").value;
          if (!(messageInput === null)) {
              sock.send(JSON.stringify({ message: messageInput, username: "{{request.user.username}}" }));
          }
      };

      sock.onmessage = function(event) {
          const data = JSON.parse(event.data);
          document.querySelector("#unos_Poruka").value = "";
          document.querySelector('#kontejner_Poruka').value += (data.username + " : " + data.message + '\n');
      };
    </script>
  </body>
</html>